<!DOCTYPE html>
<html>
<head>
    <title>Factura Procesada - ReciptAI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #333;
            -webkit-print-color-adjust: exact;
        }

        .container {
            width: 800px;
            margin: 20px auto;
            padding: 40px;
            background-color: #fff;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .invoice-details {
            text-align: right;
            font-size: 14px;
        }

        .invoice-details div {
            margin-bottom: 5px;
        }

        .invoice-details span {
            font-weight: 500;
        }

        .party-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }

        .party-box {
            width: 48%;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-sizing: border-box;
            border: 1px solid #eee;
        }

        .party-box h4 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
            color: #555;
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .party-box h4 svg {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            fill: #555;
        }

        .party-info div {
            margin-bottom: 5px;
            font-size: 14px;
            line-height: 1.4;
        }

        .party-info strong {
            display: block;
            margin-bottom: 5px;
            font-size: 15px;
            color: #333;
            font-weight: 600;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 40px;
        }

        .items-table th, .items-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .items-table th {
            background-color: #f5f5f5;
            font-weight: 600;
            font-size: 14px;
            color: #555;
        }

        .items-table td {
            font-size: 14px;
            color: #444;
        }

        .items-table .description {
            font-weight: 500;
        }

        .items-table .text-right {
            text-align: right;
        }

        .summary-section {
            width: 350px;
            margin-left: auto;
            margin-bottom: 40px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .summary-row .label {
            color: #555;
        }

        .summary-row .value {
            font-weight: 500;
        }

        .summary-row.total {
            font-size: 18px;
            font-weight: 700;
            border-top: 2px solid #333;
            padding-top: 10px;
            margin-top: 15px;
            color: #333;
        }

        .tax-details {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .tax-details h4 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
            color: #555;
            font-weight: 600;
        }

        .tax-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .payment-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #e0e7ff;
        }

        .payment-box {
            width: 100%;
        }

        .payment-box h4 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
            color: #555;
            font-weight: 600;
        }

        .footer {
            text-align: center;
            font-size: 12px;
            color: #999;
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            background-color: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">📄 {{ supplier }}</div>
            <div class="invoice-details">
                <div>Número de Factura: <span class="highlight">{{ invoice_number }}</span></div>
                <div>Fecha de Emisión: <span>{{ date }}</span></div>
                {% if due_date %}
                <div>Fecha de Vencimiento: <span>{{ due_date }}</span></div>
                {% endif %}
                <div>Tipo: <span class="badge">{{ document_type | title }}</span></div>
            </div>
        </header>

        <section class="party-details">
            <div class="party-box from-box">
                <h4>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.38 0 2.5 1.12 2.5 2.5S13.38 10 12 10 9.5 8.88 9.5 7.5 10.62 5 12 5zm-1 12.5v-2.5h2v2.5H11zm-2 0V14h6v3.5h-6zM12 11c-2.33 0-7 1.17-7 3.5V17c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                    PROVEEDOR
                </h4>
                <div class="party-info">
                    <strong>{{ supplier }}</strong>
                    {% if supplier_cif %}
                    <div><strong>CIF/NIF:</strong> {{ supplier_cif }}</div>
                    {% endif %}
                    {% if supplier_email %}
                    <div><strong>Email:</strong> {{ supplier_email }}</div>
                    {% endif %}
                    {% if supplier_phone %}
                    <div><strong>Teléfono:</strong> {{ supplier_phone }}</div>
                    {% endif %}
                    <div><strong>Dirección:</strong> {{ adress }}</div>
                    <div><strong>Ciudad:</strong> {{ city }}</div>
                </div>
            </div>
            <div class="party-box to-box">
                <h4>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.38 0 2.5 1.12 2.5 2.5S13.38 10 12 10 9.5 8.88 9.5 7.5 10.62 5 12 5zm-1 12.5v-2.5h2v2.5H11zm-2 0V14h6v3.5h-6zM12 11c-2.33 0-7 1.17-7 3.5V17c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                    CLIENTE
                </h4>
                <div class="party-info">
                    <strong>{{ customer_name }}</strong>
                    {% if customer_cif %}
                    <div><strong>CIF/NIF:</strong> {{ customer_cif }}</div>
                    {% endif %}
                    {% if customer_address %}
                    <div><strong>Dirección:</strong> {{ customer_address }}</div>
                    {% else %}
                    <div>Procesado por ReciptAI</div>
                    <div>Sistema de digitalización automática</div>
                    {% endif %}
                </div>
            </div>
        </section>

        <table class="items-table">
            <thead>
                <tr>
                    <th>Descripción</th>
                    <th class="text-right">Cant.</th>
                    <th class="text-right">Precio Unit.</th>
                    <th class="text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in line_items %}
                <tr>
                    <td class="description">{{ item.description }}</td>
                    <td class="text-right">{{ item.quantity | default(1) }}</td>
                    <td class="text-right">{{ "%.2f"|format(item.unit_price | default(0)) }} {{ currency | default('EUR') }}</td>
                    <td class="text-right">{{ "%.2f"|format(item.total | default(0)) }} {{ currency | default('EUR') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if tax_rate > 0 %}
        <section class="tax-details">
            <h4>📊 Desglose de Impuestos</h4>
            <div class="tax-row">
                <span>Base Imponible:</span>
                <span>{{ "%.2f"|format(tax_base | default(total_net)) }} {{ currency | default('EUR') }}</span>
            </div>
            <div class="tax-row">
                <span>IVA/Impuesto ({{ tax_rate }}%):</span>
                <span>{{ "%.2f"|format(tax_amount | default(total_tax)) }} {{ currency | default('EUR') }}</span>
            </div>
        </section>
        {% endif %}

        <section class="summary-section">
            <div class="summary-row">
                <span class="label">Subtotal (sin impuestos)</span>
                <span class="value">{{ "%.2f"|format(total_net | default(0)) }} {{ currency | default('EUR') }}</span>
            </div>
            <div class="summary-row">
                <span class="label">Impuestos</span>
                <span class="value">{{ "%.2f"|format(total_tax | default(0)) }} {{ currency | default('EUR') }}</span>
            </div>
            <div class="summary-row total">
                <span class="label">TOTAL</span>
                <span class="value">{{ "%.2f"|format(total_amount | default(0)) }} {{ currency | default('EUR') }}</span>
            </div>
        </section>

        <section class="payment-info">
            <div class="payment-box">
                <h4>💳 Información de Pago</h4>
                <div><strong>Método de pago:</strong> {{ payment_method | default('No especificado') }}</div>
                {% if due_date %}
                <div><strong>Vencimiento:</strong> {{ due_date }}</div>
                {% endif %}
            </div>
        </section>

        <footer class="footer">
            <div>Factura procesada automáticamente por <strong>ReciptAI</strong></div>
            <div>Generado el {{ current_date }} - Sistema de digitalización inteligente</div>
            <div style="margin-top: 10px; font-size: 11px; color: #bbb;">
                ID de Template: {{ APITEMPLATE_TEMPLATE_ID | default('20877b23684b10a8') }}
            </div>
        </footer>
    </div>
</body>
</html> 